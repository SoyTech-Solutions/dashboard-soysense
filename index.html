<!doctype html>
<html>

<head>
    <title>SoySense | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/c32b893528.js" crossorigin="anonymous"></script>
    <script src="./js/dashboard.js" defer></script>

    <link rel="stylesheet" href="./css/global-style.css">
    <link rel="stylesheet" href="./css/dashboard-style.css">

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>

    <aside class="side-bar">
        <div class="logo-wrapper">
            <img src="./icon/logo-soysense.png"/>
        </div>
        <div class="profile-wrapper">
            <div class="profile-picture">
                <img src="./img/profile.jpg"/>
            </div>
            <span>Admin</span>
            <h4>Fernanda</h4>
        </div>
        <div class="line-side-bar"></div>
        <nav class="nav-side-bar">
            <ul class="accordion-menu">
                <li class="accordion-item"> 
                    <div class="accordion-item-header">
                        <a href="">Exemplo</a>
                    </div>
                </li>
                <li class="accordion-item">
                    <div class="accordion-item-header">Exemplo</div>
                    <ul class="accordion-submenu">
                        <li class="accordion-subitem"><a href="">Exemplo 1 1</a></li>
                        <li class="accordion-subitem"><a href="">Exemplo 1 2</a></li>
                        <li class="accordion-subitem"><a href="">Exemplo 1 3</a></li>
                    </ul>
                </li>
                <li class="accordion-item">
                    <div class="accordion-item-header">Exemplo</div>
                    <ul class="accordion-submenu">
                        <li class="accordion-subitem"><a href="">Exemplo 1 1</a></li>
                        <li class="accordion-subitem"><a href="">Exemplo 1 2</a></li>
                        <li class="accordion-subitem"><a href="">Exemplo 1 3</a></li>
                    </ul>
                </li>

            </ul>
        </nav>
    </aside>
    <main>
        <!-- <section style="width:300px">
            <canvas id="dht11Umidade"></canvas>
        </section>
        <section style="width: 300px;">
            <canvas id="lm35Temperatura"></canvas>
        </section> -->
    </main>

    <script> 
        const accordionItems = document.querySelectorAll('.accordion-item');

        accordionItems.forEach(item => {
          item.addEventListener('click', () => {
            // Toggle active class on clicked item
            item.classList.toggle('active');
      
            // Hide all other accordion content
            const siblingContents = item.parentNode.querySelectorAll('.accordion-content');
            siblingContents.forEach(content => {
              if (content !== item.nextElementSibling) {
                content.style.display = 'none';
              }
            });
          });
        });

        /* -- dht11Umidade -- */
        var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
        var dht11Umidade = new Chart(
            contextoDht11Umidade,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Umidade',
                        type: 'line',
                        borderColor: ['#45b3e7'],
                        backgroundColor: ['#89cff0']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Umidade'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );
        /* -- lm35Temperatura */
        var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
        var lm35Temperatura = new Chart(
            contextoLm35Temperatura,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Temperatura',
                        type: 'line',
                        borderColor: ['#ffd902'],
                        backgroundColor: ['#ffe135']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Temperatura'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        var paginacao = {};
        var tempo = {};
        function obterDados(grafico, valoresAleatorio) {
            var valores = valoresAleatorio;
            if (paginacao[valoresAleatorio] == null) {
                paginacao[valoresAleatorio] = 0;
            }
            if (tempo[valoresAleatorio] == null) {
                tempo[valoresAleatorio] = 0;
            }
            // Exibir à partir do último elemento exibido anteriormente
            var ultimaPaginacao = paginacao[valoresAleatorio];
            paginacao[valoresAleatorio] = valores.length;
            var valores = valores.slice(ultimaPaginacao);
            //Máximo de 60 itens exibidos no gráfico
            if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                grafico.data.labels.shift();
                grafico.data.datasets[0].data.shift();
            }

            grafico.data.labels.push(tempo[valoresAleatorio]++);
            grafico.data.datasets[0].data.push(parseFloat(valoresAleatorio));
            grafico.update();
            
        }

        setInterval(() => {
            let minTemp = 20;
            let maxTemp = 30;

            let minUmid = 10;
            let maxUmid = 15;


            let num1 = parseInt(Math.random() * (maxUmid - minUmid) + minUmid);
            let num2 = parseInt(Math.random() * (maxTemp - minTemp) + minTemp);

            var valoresAleatorio = `${num1};${num2}`;

            valoresAleatorio = valoresAleatorio.split(';')
            console.log(valoresAleatorio);


            obterDados(dht11Umidade, valoresAleatorio[0]);
            obterDados(lm35Temperatura, valoresAleatorio[1]);
        }, 1000);

    </script>
</body>

</html>