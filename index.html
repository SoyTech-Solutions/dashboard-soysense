<!doctype html>
<html>

<head>
    <title>SoySense | Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>

    <script src="./js/dashboard.js" defer></script>

    <link rel="stylesheet" href="./css/global-style.css">
    <link rel="stylesheet" href="./css/side-bar.css">
    <link rel="stylesheet" href="./css/dashboard.css">

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>

    <aside class="side-bar">
        <div class="logo-wrapper">
            <img src="./icon/logo-soysense.png"/>
        </div>
        <div class="profile-wrapper">
            <div class="profile-picture">
                <img src="./img/profile.jpg"/>
            </div>
            <span>Admin</span>
            <h4>Fernanda</h4>
        </div>
        <div class="line-side-bar"></div>
        <nav class="nav-side-bar">
            <ul class="accordion-menu">
                <li class="nav-normal-item dash-on">
                    <img width="17" height="17" src="https://img.icons8.com/material-outlined/24/FFFFFF/dashboard-layout.png" alt="dashboard-layout"/>
                    <a href="">Dashboard</a>
                </li>
                <li class="accordion-item">
                    <div class="accordion-item-header">
                        <img width="17" height="17" src="https://img.icons8.com/material-outlined/24/FFFFFF/address.png" alt="address"/>
                        <span>Complexo</span>
                    </div>
                    <ul class="accordion-submenu">
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Fazenda X</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Fazenda Y</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Fazenda Z</a>
                        </li>
                    </ul>
                </li>
                <li class="accordion-item">
                    <div class="accordion-item-header">
                        <img width="17" height="17" src="https://img.icons8.com/material-outlined/24/FFFFFF/document--v1.png" alt="document--v1"/>
                        <span>Relatório</span>
                    </div>
                    <ul class="accordion-submenu">
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Desempenho</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Rentabilidade</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Anomalias</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-normal-item">
                    <img width="17" height="17" src="https://img.icons8.com/material-outlined/24/FFFFFF/fine-print.png" alt="fine-print"/>                    
                    <a href="">Benchmarking</a>
                </li>
                <li class="accordion-item">
                    <div class="accordion-item-header">
                        <img width="17" height="17" src="https://img.icons8.com/material-outlined/24/FFFFFF/settings--v1.png" alt="settings--v1"/>
                        <span>Configuração</span>
                    </div>
                    <ul class="accordion-submenu">
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Sensor</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Monitor</a>
                        </li>
                        <li class="accordion-subitem">
                            <a href="">&bull;&nbsp;Complexo</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
        <div class="footer-aside">
            <div class="logout-container">
                <a href="#">
                    <img width="20" height="20" src="https://img.icons8.com/ios-filled/50/f13939/logout-rounded.png" alt="logout-rounded"/>
                    Sair
                </a>
            </div>
        </div>
    </aside>
    <main class="main-dashboard">

        <header class="header-dashboard">
            <div class="inner-header">
                <h1>Dashboard</h1>
                <a href="#">/dashboard</a>
            </div>
        </header>
        <section class="summary-container">
            <div class="summary-card">
                <div class="summary-main">

                </div>
                <div class="summary-footer ">
                    
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-main">

                </div>
                <div class="summary-footer ">
                    
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-main">

                </div>
                <div class="summary-footer ">
                    
                </div>
            </div>
            <div class="summary-card">
                <div class="summary-main">

                </div>
                <div class="summary-footer ">
                    
                </div>
            </div>
        </section>

        <section class="temp-container">
            <div class="left-temp">
                <h4>Temperatura Média (C°)</h4>
                <section>
                    <canvas id="lm35Temperatura"></canvas>
                </section>
            </div>
            <div class="right-temp">
            </div>
        </section>

        <section class="umid-container">
            <div class="left-umid">
                <h4>Umidade Média (%)</h4>
                <section>
                    <canvas id="dht11Umidade"></canvas>
                </section>
            </div>
            <div class="right-umid">
            </div>
        </section>


        <!-- <section style="width:300px;">
            <canvas id="dht11Umidade"></canvas>
        </section>
        <section style="width: 300px;">
            <canvas id="lm35Temperatura"></canvas>
        </section>  -->
    </main>

    <script> 
        /* -- lm35Temperatura */
        var contextoLm35Temperatura = document.getElementById('lm35Temperatura').getContext('2d');
        var lm35Temperatura = new Chart(
            contextoLm35Temperatura,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Temperatura',
                        type: 'line',
                        borderColor: ['#ffd902'],
                        backgroundColor: ['#ffe13588']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true,
                                fontSize: 10
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Temperatura'
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        /* -- dht11Umidade -- */
        var contextoDht11Umidade = document.getElementById('dht11Umidade').getContext('2d');
        var dht11Umidade = new Chart(
            contextoDht11Umidade,
            {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Umidade',
                        type: 'line',
                        borderColor: ['#45b3e7'],
                        backgroundColor: ['#45b4e794']
                    }]
                },
                options: {
                    scales: {
                        xAxes: [{
                            distribution: 'series',
                            ticks: {
                                beginAtZero: true,
                                fontSize: 10
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'Umidade',
    
                            },
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    animation: {
                        duration: 0
                    }
                }
            }
        );


        var paginacao = {};
        var tempo = {};
        function obterDados(grafico, valoresAleatorio) {
            var valores = valoresAleatorio;
            if (paginacao[valoresAleatorio] == null) {
                paginacao[valoresAleatorio] = 0;
            }
            if (tempo[valoresAleatorio] == null) {
                tempo[valoresAleatorio] = 0;
            }
            // Exibir à partir do último elemento exibido anteriormente
            var ultimaPaginacao = paginacao[valoresAleatorio];
            paginacao[valoresAleatorio] = valores.length;
            var valores = valores.slice(ultimaPaginacao);
            //Máximo de 60 itens exibidos no gráfico
            if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
                grafico.data.labels.shift();
                grafico.data.datasets[0].data.shift();
            }


            // capturar a hora
            var dateObj = new Date();

            var horas = dateObj.getHours();
            var minutos = dateObj.getMinutes(); 
            var segundos = dateObj.getSeconds();

            grafico.data.labels.push(`${horas}:${minutos}`);
            grafico.data.datasets[0].data.push(parseFloat(valoresAleatorio));
            grafico.update();
            
        }

        setInterval(() => {
            let minTemp = 20;
            let maxTemp = 30;

            let minUmid = 10;
            let maxUmid = 15;

            let somaTemp = 0;
            let somaUmid = 0;

            // supondo 10 sensores
            for (let i = 0; i < 10; i++) {
                // Gere valores aleatórios para cada sensor
                let num1 = parseInt(Math.random() * (maxUmid - minUmid) + minUmid);
                let num2 = parseInt(Math.random() * (maxTemp - minTemp) + minTemp);
                somaTemp += num2;
                somaUmid += num1;
            } 

            let mediaTemp = somaTemp / 10;
            let mediaUmid = somaUmid / 10;

            var valoresAleatorio = `${mediaUmid};${mediaTemp}`;

            valoresAleatorio = valoresAleatorio.split(';')
            console.log(valoresAleatorio);


            obterDados(dht11Umidade, valoresAleatorio[0]);
            obterDados(lm35Temperatura, valoresAleatorio[1]);
        }, 1000);

    </script>
</body>

</html>